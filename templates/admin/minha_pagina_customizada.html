{% extends "admin/base_site.html" %}

{% block title %}Angenda{% endblock %}

{% block extrahead %}
  {{ block.super }}
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <style>
    #calendar {
        width: 1000px;
        margin: 40px auto;
    }
  </style>
{% endblock %}

{% block sidebar %}
  {{ block.super }}
{% endblock %}

{% block content %}
  <div class="content">

    <!-- Calendário -->
    <div id="calendar"></div>

<script>
      document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'dayGridMonth', // visão inicial: mês

          headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay' // botões para mês, semana e dia
          },

          editable: true,  // ativa drag-n-drop e resize de eventos
          selectable: true,

          events: '/api/agenda/compromissos/', // API que retorna eventos JSON
          
          eventTimeFormat: {
            hour: '2-digit',
            minute: '2-digit',
            hour12: false
          },

          eventClick: function(info) {
            alert('Evento: ' + info.event.title + '\nInício: ' + info.event.start);
          },

          // Evento chamado ao mover (drag-n-drop)
          eventDrop: function(info) {
            alert('Evento movido para: ' + info.event.start.toISOString());
            // Aqui você pode fazer uma chamada AJAX para atualizar o evento no backend
          },

          // Evento chamado ao redimensionar evento
          eventResize: function(info) {
            alert('Evento redimensionado. Novo fim: ' + info.event.end.toISOString());
            // Atualizar backend se desejar
          }
        });

        calendar.render();
      });
</script>
    
  </div>
  
{% endblock %}
